# 19. ì„¸ì…˜ ê³ ì • (Session Fixation)

## 1. ê°œìš” (Overview)
- **ì •ì˜**: ê³µê²©ìê°€ ì„œë²„ë¡œë¶€í„° ìœ íš¨í•œ ì„¸ì…˜ IDë¥¼ ë¨¼ì € ë°œê¸‰ë°›ì€ ë’¤, ì´ë¥¼ í”¼í•´ìì—ê²Œ ê°•ì œë¡œ ì‚¬ìš©í•˜ê²Œ í•˜ì—¬ í”¼í•´ìê°€ í•´ë‹¹ ì„¸ì…˜ìœ¼ë¡œ ë¡œê·¸ì¸í–ˆì„ ë•Œ ê¶Œí•œì„ íƒˆì·¨í•˜ëŠ” ì·¨ì•½ì .
- **ìœ„í—˜ë„**: **ìƒ (High)** / ê³„ì • íƒˆì·¨ (Account Takeover)
- **ì˜í–¥**:
    - **ì„¸ì…˜ íƒˆì·¨**: í”¼í•´ìê°€ ë¡œê·¸ì¸í•˜ëŠ” ìˆœê°„, ê³µê²©ìê°€ ë¯¸ë¦¬ ê°–ê³  ìˆë˜ ì„¸ì…˜ IDê°€ 'ì¸ì¦ëœ ì„¸ì…˜'ìœ¼ë¡œ ìŠ¹ê²©ë˜ì–´ ê³µê²©ìë„ ë¡œê·¸ì¸ ìƒíƒœê°€ ë¨.

> **ğŸ’¡ í•µì‹¬ ì›ë¦¬ (The Trap)**
>
> "ë„ë‘‘(í•´ì»¤)ì´ ë¯¸ë¦¬ ë³µì‚¬í•´ ë‘” í˜¸í…” í‚¤ ì¹´ë“œë¥¼ íˆ¬ìˆ™ê°(í”¼í•´ì) ì£¼ë¨¸ë‹ˆì— ëª°ë˜ ë„£ì–´ë‘”ë‹¤. íˆ¬ìˆ™ê°ì´ ê·¸ ì¹´ë“œë¡œ ì²´í¬ì¸(ë¡œê·¸ì¸)ì„ í•˜ë©´, ë„ë‘‘ë„ ë˜‘ê°™ì€ í‚¤ ì¹´ë“œë¡œ ë°©ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤."

---

## 2. ê³µê²© ë©”ì»¤ë‹ˆì¦˜ (Attack Vector)

### ì‹œë‚˜ë¦¬ì˜¤: ë¡œê·¸ì¸ ì „í›„ ì„¸ì…˜ ID ë¶ˆë³€ (Immutable Session ID)
**1. ë¯¸ë¼ ì¤€ë¹„ (Trap Setup)**
- í•´ì»¤ê°€ ê³µê²© ëŒ€ìƒ ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ì—¬ ìµëª… ì„¸ì…˜ IDë¥¼ ë°œê¸‰ë°›ìŒ.
- ì˜ˆ: `JSESSIONID=HACKER_SESSION_123`

**2. ë¯¸ë¼ íˆ¬ì²™ (Delivery)**
- í•´ì»¤ê°€ í”¼í•´ìì—ê²Œ ì´ë©”ì¼ì´ë‚˜ ê²Œì‹œíŒ ë§í¬ë¡œ í•´ë‹¹ ì„¸ì…˜ IDê°€ í¬í•¨ëœ URLì„ ì „ë‹¬.
- ì˜ˆ: `http://vulnerable-bank.com/login.jsp?JSESSIONID=HACKER_SESSION_123`
- ë˜ëŠ” XSS ì·¨ì•½ì ì„ ì´ìš©í•´ í”¼í•´ìì˜ ë¸Œë¼ìš°ì € ì¿ í‚¤ë¥¼ ê°•ì œë¡œ ì„¤ì •.

**3. í”¼í•´ì ë¡œê·¸ì¸ (Execution)**
- í”¼í•´ìëŠ” ì•„ë¬´ ì˜ì‹¬ ì—†ì´ ë§í¬ë¥¼ í†µí•´ ì ‘ì†í•˜ê³  ë¡œê·¸ì¸ì„ ìˆ˜í–‰.
- **ì·¨ì•½ì  ë°œìƒ**: ì„œë²„ê°€ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ **ìƒˆë¡œìš´ ì„¸ì…˜ IDë¥¼ ë°œê¸‰í•˜ì§€ ì•Šê³ , í•´ì»¤ê°€ ì¤€ `HACKER_SESSION_123`ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ ì •ë³´ë¥¼ ìœ ì§€í•¨.**

**4. ê³„ì • íƒˆì·¨ (Hijack)**
- í•´ì»¤ëŠ” ì´ë¯¸ ì•Œê³  ìˆëŠ” `HACKER_SESSION_123`ì„ ì´ìš©í•´ ìƒˆë¡œê³ ì¹¨ì„ í•¨.
- í”¼í•´ìê°€ ë¡œê·¸ì¸í–ˆìœ¼ë¯€ë¡œ, ì´ ì„¸ì…˜ì€ ì´ì œ 'ì¸ì¦ëœ ì‚¬ìš©ì'ì˜ ì„¸ì…˜ì´ ë¨. í•´ì»¤ ì ‘ì† ì„±ê³µ.

---

## 3. ì·¨ì•½í•œ ì½”ë“œ vs ì•ˆì „í•œ ì½”ë“œ (Java/Spring)

í•µì‹¬ì€ **"ë¡œê·¸ì¸ ì„±ê³µ ì‹œ, ê¸°ì¡´ ì„¸ì…˜ì€ ë¬´ì¡°ê±´ ë²„ë¦¬ê³  ìƒˆ ê·¸ë¦‡(New Session)ì„ ì¨ì•¼ í•œë‹¤"** ëŠ” ì .

### âŒ ì·¨ì•½í•œ ì½”ë“œ (ì„¸ì…˜ ì¬ì‚¬ìš©)
> ë¡œê·¸ì¸ ì„±ê³µ í›„, ê¸°ì¡´ì— í• ë‹¹ëœ ì„¸ì…˜(`request.getSession()`)ì— ì†ì„±ë§Œ ì¶”ê°€í•˜ëŠ” ë°©ì‹. ì„¸ì…˜ IDê°€ ë°”ë€Œì§€ ì•ŠìŒ.

```java
// LoginController.java
@PostMapping("/login")
public String login(String id, String pw, HttpServletRequest request) {
    MemberVO member = memberService.login(id, pw);
    
    if (member != null) {
        // ì·¨ì•½ì : ê¸°ì¡´ì— ë°œê¸‰ëœ ì„¸ì…˜(ìµëª… ì„¸ì…˜)ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        HttpSession session = request.getSession(); 
        
        // ì—¬ê¸°ì— ë¡œê·¸ì¸ ì •ë³´ë§Œ ì–¹ìŒ
        session.setAttribute("userId", member.getId());
        return "main";
    }
    return "login";
}
```
### âœ… ì•ˆì „í•œ ì½”ë“œ (ë¡œê·¸ì¸ ì‹œ ì„¸ì…˜ ì¬ë°œê¸‰ - Session Migration)
- ë¡œê·¸ì¸ ì§í›„ session.invalidate()ë¡œ ê¸°ì¡´ ì„¸ì…˜ì„ íŒŒê¸°í•˜ê³ , ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•˜ì—¬ IDë¥¼ êµì²´í•¨.

```java
// LoginController.java
@PostMapping("/login")
public String login(String id, String pw, HttpServletRequest request) {
    MemberVO member = memberService.login(id, pw);
    
    if (member != null) {
        HttpSession oldSession = request.getSession(false);
        if (oldSession != null) {
            // 1. ê¸°ì¡´ ì„¸ì…˜ íŒŒê¸° (ë§¤ìš° ì¤‘ìš”)
            oldSession.invalidate();
        }
        
        // 2. ìƒˆë¡œìš´ ì„¸ì…˜ ìƒì„± (ì´ë•Œ ìƒˆë¡œìš´ JSESSIONIDê°€ ë°œê¸‰ë¨)
        HttpSession newSession = request.getSession(true);
        
        // 3. ìƒˆ ì„¸ì…˜ì— ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
        newSession.setAttribute("userId", member.getId());
        return "main";
    }
    return "login";
}
```

## 4. ëŒ€ì‘ ë°©ì•ˆ (Remediation Checklist)
1. ë¡œê·¸ì¸ ì‹œ ì„¸ì…˜ ì¬ë°œê¸‰ (Essential):

- ì¸ì¦ ì„±ê³µ ì§í›„, ë°˜ë“œì‹œ ê¸°ì¡´ ì„¸ì…˜ì„ ì¢…ë£Œ(invalidate)í•˜ê³  ìƒˆë¡œìš´ ì„¸ì…˜ IDë¥¼ ë°œê¸‰ë°›ì•„ ì‚¬ìš©í•œë‹¤. (Java Spring Securityì—ì„œëŠ” migrateSession ë˜ëŠ” changeSessionId ì„¤ì •ìœ¼ë¡œ ìë™ ì§€ì›)

2. ì„¸ì…˜ ID ì „ë‹¬ ë°©ì‹ ì œí•œ (URL Rewriting ê¸ˆì§€):

- ì„¸ì…˜ IDê°€ URL íŒŒë¼ë¯¸í„°(;jsessionid=...)ë¡œ ë…¸ì¶œë˜ê±°ë‚˜ ì „ë‹¬ë˜ì§€ ì•Šë„ë¡ ì„¤ì •í•œë‹¤.

- ì˜¤ì§ Cookieë¥¼ í†µí•´ì„œë§Œ ì„¸ì…˜ì„ ê´€ë¦¬í•˜ë„ë¡ ê°•ì œí•œë‹¤.

3. ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì„¤ì •:

- ìœ íš¨ ì‹œê°„ì„ ì§§ê²Œ ì„¤ì •í•˜ì—¬, ê³µê²©ìê°€ ë§Œë“¤ì–´ë‘” ë¯¸ë¼ ì„¸ì…˜ì´ í”¼í•´ìê°€ ë¡œê·¸ì¸í•˜ê¸° ì „ì— ë§Œë£Œë˜ë„ë¡ ìœ ë„í•œë‹¤.

