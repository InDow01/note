# 08. Directory Indexing (디렉토리 인덱싱)

## 1. 개요 (Overview)
- **정의**: 웹 서버의 특정 디렉토리에 접근했을 때, 기본 페이지(index.html, index.jsp 등)가 존재하지 않을 경우 **서버가 해당 디렉토리의 파일 목록을 자동으로 나열해 보여주는 취약점**.
- **별칭**: Directory Listing (디렉토리 리스팅)
- **위험도**: **중 (Medium)** / 정보 노출 (Information Leakage)
- **영향**:
    - 백업 파일(.bak, .zip), 소스코드, 설정 파일 노출.
    - 웹 애플리케이션의 디렉토리 구조 파악 용이.
    - **2차 공격의 시발점** (노출된 소스코드를 분석해 SQL Injection 등 수행).

> **💡 핵심 원리**
> "보여줄 대문(index.html)이 없으면, **창고 안(파일 목록)을 다 보여줘라**"라는 서버의 기본 설정(Default) 때문에 발생.

---

## 2. 공격 메커니즘 (Attack Vector)

### 시나리오: 자료실 파일 탈취
웹 서버에 자료를 업로드하는 `/uploads/` 폴더가 있다고 가정.

**1. 정상 접근**
- URL: `http://site.com/uploads/image.png`
- 결과: 이미지 파일이 보임.

**2. 공격 접근 (파일명 삭제)**
- URL: `http://site.com/uploads/`
- **취약한 경우**: 브라우저에 **"Index of /uploads"** 라는 제목과 함께 파일 목록이 쫙 뜸.
    - `secret_v1.zip`
    - `db_connect.inc`
    - `image.png`
- **공격**: 공격자는 URL 추측 없이 `secret_v1.zip`을 클릭해서 다운로드함.



---

## 3. 취약한 설정 vs 안전한 설정 (Apache + Tomcat)

이 취약점은 **Java 코드가 아니라 서버 설정 파일**을 수정해야 함.

### ① Apache Web Server (httpd.conf)

**❌ 취약한 설정**
> `Options Indexes`: 인덱싱 기능을 **켠다**는 의미.

```apache
<Directory "/var/www/html">
    # Indexes 옵션이 있으면 파일 목록을 보여줌 (위험)
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>
```
**✅ 안전한 설정**
> `Options -Indexes`: 인덱싱 기능을 **끈다(Minus)**는 의미.
```apache
<Directory "/var/www/html">
    # 마이너스(-)를 붙여서 인덱싱 비활성화 (필수)
    Options -Indexes FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>
```

### ② Tomcat WAS (web.xml)

Tomcat은 기본적으로 이 기능이 꺼져(false) 있지만, 개발 편의를 위해 켜두는 경우가 있음.

**❌ 취약한 설정**
>listings 값이 true로 설정됨.
```tomcat
<servlet>
    <servlet-name>default</servlet-name>
    <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>
    <init-param>
        <param-name>debug</param-name>
        <param-value>0</param-value>
    </init-param>
    <init-param>
        <param-name>listings</param-name>
        <param-value>true</param-value> </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>
```
**✅ 안전한 설정**
>listings 값을 false로 변경.
```tomcat
<init-param>
        <param-name>listings</param-name>
        <param-value>false</param-value> </init-param>
```

## 4. 심화
또한 추가로, 에러 페이지시 발생할 수 있는 아파치나 톰캣의 오류화면을 숨겨야 함. 이는 정보노출에 해당하는 취약점이므로, 따로 커스텀 에러페이지를 만들어서 에러시에는 커스텀 에러페이지로 리다이렉션 해야함.

### 구글 도킹(Google Dorking)
디렉터리 인덱싱과 관련해서 항상 나오는 구글을 이용한 해킹 기법임.
구글의 고급 검색 연산자를 활용하여, 전세계에 널려 있는 취약한 웹사이트나 민감한 정보를 찾는 것임.

>이게 왜 가능하죠?

검색 봇의 특징 : 구글 봇(Crawler)은 인터넷을 돌아다니며 모든 텍스트를 긁어감.

취약점의 노출 : 만약 서버에 `Directory Indexing`이 켜져있다면 브라우저 타이틀에 "Index of/" 라는 문구가 찍히고, 화면에는 파일 목록이 뜸

인덱싱 저장 : 구글 봇은 이걸 보고 저장해버림.

그리고 해커는 그냥 다 쳐버림

검색어 : `intitle:"index of" "password.txt"`

그러면 페이지 제목에 Index of 라는 텍스트가 들어간 사이트만 찾아줘, 그리고 파일목록에 password.txt가 있는 것만 찾아줘 라는 의미로 검색이 됨.

이는 전세계 해커들에게 우리집 문 열려있음 이라고 광고하는 꼴임. 