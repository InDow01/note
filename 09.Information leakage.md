# 09. Information Leakage (정보 누출)

## 1. 개요 (Overview)
- **정의**: 웹 애플리케이션이 개발 과정의 **주석(Comment)**, **디버깅 정보**, **에러 메시지(Stack Trace)**, **백업 파일** 등을 사용자에게 불필요하게 노출하여, 공격자가 시스템 내부 구조를 파악할 수 있게 하는 취약점.
- **위험도**: **하~중 (Low to Medium)**
- **영향**:
    - 시스템 버전(Apache/Tomcat 버전) 노출 → 해당 버전의 **CVE(알려진 취약점)** 공격 시도.
    - DB 구조(컬럼명, 테이블명) 파악 → **SQL Injection** 공격 성공률 상승.
    - 개발자 계정/비밀번호/테스트 계정 노출.

> **💡 핵심 원리**
>
>사용자(Client)에게는 **결과 화면**만 보여줘야 하는데, 과정(Process)이나 속사정(Debug Info)까지 다 보여줘서 문제.

---

## 2. 공격 메커니즘 (Attack Vector)

### 시나리오 1: 소스코드 보기 (View Source)
개발자가 나중에 고치려고 적어둔 메모를 삭제하지 않고 배포함.

1.  **해커 행동**: 웹 페이지에서 `F12` 또는 `우클릭 -> 소스 보기` 클릭.
2.  **발견된 주석**:
    ```html
    #대충 중요한 정보
    ```
3.  **결과**: 로그인 시도 또는 DB 직접 접속 시도.

### 시나리오 2: 에러 유발 (Error Triggering)
일부러 특수문자나 잘못된 값을 넣어 서버 에러(500)를 유발함.

1.  **해커 행동**: URL 뒤에 `'` (싱글 쿼터)를 입력 (`http://site.com/board?id='`)
2.  **서버 응답 (Stack Trace 노출)**:
    ```
    java.sql.SQLException: ORA-00933: SQL command not properly ended
    at com.mycompany.dao.UserDAO.getUser(UserDAO.java:45)
    ...
    SELECT * FROM users_v2 WHERE id = '''
    ```
3.  **결과**: "아, 오라클 DB를 쓰는구나", "테이블명이 users_v2 구나", "UserDAO 파일 45번째 줄에 쿼리가 있구나" → **SQL Injection 공격 쿼리 작성에 활용.**



---

## 3. 취약한 코드 vs 안전한 코드 (JSP/Java)

### ① 주석 (Comments) 처리
JSP 환경에서 HTML 주석과 JSP 주석의 차이를 아는 것이 핵심.

**❌ 취약한 코드 (HTML 주석)**
> 브라우저로 전송되어 `소스 보기`를 하면 다 보임.

```html
<h1>메인 페이지</h1>

```
**✅ 안전한 코드 (JSP 주석)**

서버(Tomcat)에서 컴파일될 때 제거되므로, 브라우저로 전송되지 않음 (사용자는 볼 수 없음).
```html
<%-- 
    작성자: 김개발
    수정일: 2026-01-01
    로직: 서버 사이드 주석이므로 안전함.
--%>
<h1>메인 페이지</h1>
```
### ② 예외 처리 (Exception Handling)
**❌ 취약한 코드 (printStackTrace 사용)**

에러의 상세 내용(DB 구조, 경로 등)을 콘솔이나 화면에 그대로 출력함.

```java
try {
    // DB 연결 및 쿼리 실행 로직
} catch (Exception e) {
    // ⚠️ 개발 중에는 편하지만, 운영 환경에서는 치명적 정보 노출
    e.printStackTrace(); 
}
```

**✅ 안전한 코드 (Logger 사용 + 사용자 알림)**

로그 파일에는 상세 정보를 남기되, 사용자에게는 "에러가 발생했습니다"라는 단순 메시지만 보여줌.

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

private static final Logger logger = LoggerFactory.getLogger(MyClass.class);

try {
    // 로직 실행
} catch (Exception e) {
    // 1. 서버 로그 파일에만 상세 내용 기록 (사용자 노출 X)
    logger.error("DB Connection Error: ", e);
    
    // 2. 사용자에게는 정제된 메시지 전달 (또는 커스텀 에러 페이지로 이동)
    throw new CustomException("일시적인 시스템 오류입니다. 관리자에게 문의하세요.");
}
```

## 5. 핵심 요약 (Key Takeaways)
원인: 개발자의 부주의(주석 미삭제) 및 미흡한 예외 처리.

주석 보안: HTML 주석(``) 대신 JSP 주석(<%-- --%>)을 사용하여 클라이언트 노출 방지.

에러 보안: e.printStackTrace() 사용을 금지하고, Logger 사용 및 커스텀 에러 페이지 적용.

불필요한 파일 삭제: .bak, .old, .zip 등 백업 파일이 웹 경로에 남지 않도록 배포 전 점검.

